{"componentChunkName":"component---src-templates-blog-post-js","path":"/finding-all-domains-used-to-sync-onedrive/","result":{"data":{"markdownRemark":{"id":"93698b5c-0e46-5cff-aece-40c349eeafdf","parent":{"relativePath":"blog/2020-04-22-finding-all-domains-used-to-sync-onedrive.md"},"fields":{"slug":"/finding-all-domains-used-to-sync-onedrive/"},"html":"<p>This is most useful if your environment consist of many different domains and/or forests. To get such data we'll be using audit log functionality in Microsoft 365 Compliance Center.</p>\n<h2 id=\"table-of-contents\" style=\"position:relative;\"><a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table of Contents</h2>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#prerequisites\">Prerequisites</a></p>\n<ul>\n<li><a href=\"#auditing-turned-on\">Auditing turned on</a></li>\n<li><a href=\"#exchange-online-powershell-module-installed\">Exchange Online PowerShell module installed</a></li>\n<li><a href=\"#proper-role\">Proper role</a></li>\n</ul>\n</li>\n<li><a href=\"#getting-data-from-gui\">Getting data from GUI</a></li>\n<li><a href=\"#getting-data-programatically\">Getting data programatically</a></li>\n<li><a href=\"#code-deep-dive\">Code deep dive</a></li>\n</ul>\n</div>\n<h2 id=\"prerequisites\" style=\"position:relative;\"><a href=\"#prerequisites\" aria-label=\"prerequisites permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prerequisites</h2>\n<h3 id=\"auditing-turned-on\" style=\"position:relative;\"><a href=\"#auditing-turned-on\" aria-label=\"auditing turned on permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Auditing turned on</h3>\n<p>If you're not sure if it's already turned on, go to <a href=\"https://compliance.microsoft.com/auditlogsearch\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Audit page in M365 Compliance Center</a> and check if you have the option to start recording activity:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1366px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/94a128c7207fbc15b5e669fd71d4bc24/ad00e/2020-11-17-21_25_11-.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.14012738853503%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABy0lEQVQoz42S227aQBRF/al97Ev/oQkGkqjqU9t/iKpEkfIBUVpViqokTQVCQMEJBhuDjbHHxhd82T1nnCBKIyUjLY1nPCzvcxhlbtuYzWawadZHI7RaLbTbbXQ6HXS7XQwGgxcZEr/v7nB7cwOlrtZwdNjEh6ND8HNtfw/Nhkrze6i1fTTq6ha1nXW1d9Cso6FW75Rer4fhcCi5v9cwmUzQ7/+BLwQ8n/EhGMGIaqa1v9kXWDiOrNB1XSiGYUjJdDqVG0m0Qug5KNIIeRwiS2gdhgiCoIIEPLMoEAHCIJRyJs9zKLquQ6NkY5IuHOqjLXBya+KU+Hpt4PyXAT8keZYhTVOs1+tnyeg9o4xJyAnNqQXftfHzQeDN8QhvT0Z4dzbG976DMs/wmlEURSU0TVP+0/P5HFGcIE7pawWQ5aU8WJalPMxwWQzv7VKVTFeF+/gkjOMY7mIB31siWq0QJwmiKNqUy73yPE/2kc/+J+RyWWhZlpQmJFgul/Qjn9LGUpRTybtpZFoiY0i06aGmaf+UzF9lISfgJJxoRUlZsD1Y+txQtAcdFl0ZTshCTsjXhNku9Ukg0z0+/9AnOLi6xsezc3z59BkXl9/wF8B6J7eltKzNAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 11 17 21 25 11 \"\n        title=\"2020 11 17 21 25 11 \"\n        src=\"/static/94a128c7207fbc15b5e669fd71d4bc24/ad00e/2020-11-17-21_25_11-.png\"\n        srcset=\"/static/94a128c7207fbc15b5e669fd71d4bc24/1f09d/2020-11-17-21_25_11-.png 471w,\n/static/94a128c7207fbc15b5e669fd71d4bc24/f1901/2020-11-17-21_25_11-.png 942w,\n/static/94a128c7207fbc15b5e669fd71d4bc24/ad00e/2020-11-17-21_25_11-.png 1366w\"\n        sizes=\"(max-width: 1366px) 100vw, 1366px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>If the button is available and the search is greyed out, you need to turn the audit log on first.</p>\n<h3 id=\"exchange-online-powershell-module-installed\" style=\"position:relative;\"><a href=\"#exchange-online-powershell-module-installed\" aria-label=\"exchange online powershell module installed permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exchange Online PowerShell module installed</h3>\n<p>See <a href=\"https://docs.microsoft.com/en-us/powershell/exchange/exchange-online-powershell?view=exchange-ps\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">the article about Exchange Online module</a> for more details about installation and connecting to your environment.</p>\n<h3 id=\"proper-role\" style=\"position:relative;\"><a href=\"#proper-role\" aria-label=\"proper role permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proper role</h3>\n<p><em>View-Only Audit Logs</em> or <em>Audit Logs</em> role <strong>in Exchange Online</strong> is required (<a href=\"https://docs.microsoft.com/en-us/microsoft-365/compliance/search-the-audit-log-in-security-and-compliance?view=o365-worldwide\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">source</a>).</p>\n<p>If your account has <em>Global Admin</em> (in Microsoft 365) or <em>Organization Management</em> (in Exchange Online), that should be enough. In the environment, where access is limited, check if the role assigned to your account has the correct permission level.</p>\n<p>In <a href=\"https://outlook.office365.com/ecp/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">legacy admin center</a>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1366px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0f94b3b6bc6556ba326e0e2afcbd9fe3/ad00e/2020-11-17-21_42_55-.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.044585987261144%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7CAAAOwgEVKEqAAAABOklEQVQoz41RWU7DMBT0eburVTkYPUchoKLyjbpIKHbsOI7jnXFSSgs/jMbOW6SXmWfysF6vVsvxeDSbjuezyWI2mf/i9IfTyWgg4tVyQWTnam0b440LMUbrg/cB5woU0ze6rlOqbZVqmkZrTUwtgzFoGGORh5RC+i9I+XFkp7NqtZBSVBU/n8rDgVOa07oGuRBgJXiH8dbl43xPR1zIwBgknLH37Xb/9Lwvitd7FMULY0xKyblQSnWdgXKi29ZcZBtUIUE26q9CGG84l0LAMmCtxU3wCSGvBAGGCYjkPIYY7uG8F4djQ+llUr88orMVh0z3SmSPwcgtUCkZ+yxLCBz2j5+RFF1KPre9d9bgnVyP2xfqu6FiFaX0OhcB2ezo5o094t6VlcrmYSL2PQgb3hlA2rYae7LfgIQv79Uh7IhRlGIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 11 17 21 42 55 \"\n        title=\"2020 11 17 21 42 55 \"\n        src=\"/static/0f94b3b6bc6556ba326e0e2afcbd9fe3/ad00e/2020-11-17-21_42_55-.png\"\n        srcset=\"/static/0f94b3b6bc6556ba326e0e2afcbd9fe3/1f09d/2020-11-17-21_42_55-.png 471w,\n/static/0f94b3b6bc6556ba326e0e2afcbd9fe3/f1901/2020-11-17-21_42_55-.png 942w,\n/static/0f94b3b6bc6556ba326e0e2afcbd9fe3/ad00e/2020-11-17-21_42_55-.png 1366w\"\n        sizes=\"(max-width: 1366px) 100vw, 1366px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Or <a href=\"https://admin.exchange.microsoft.com/#/adminRoles\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">in the new one</a>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1366px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ca2b613d0bcd268b24bc6cf8b583d2e1/ad00e/2020-11-17-21_43_36-window.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.044585987261144%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7CAAAOwgEVKEqAAAABf0lEQVQoz1VR2W7CMBDMF7ecLdAvpG8FAgk4SAUBuYwdO/fZsa1K7WQVJesd7+ysNZtOPlbL1XIxen2ZjEfz2XQ+m/yN2XSM5BtirgL1eC/e5wjLtm3HOQCe5wkhrpfL/f4oy3IYhq7r+r5v6jpR4HhEkkgpu1blcWrt94eD4xByOp/PRVEwxp7PJ27JsizVyPOcUhqGQRTFD9/nnIM5aFg7jePxSAipqqppmqquEcMvkIEQHHGR5mWFhrUqUJWKDOWK7JEyzTKeSEpLKWshijyHSDAzDSkFZ4wzDjnI4wprt91iZNd10Tl9svB6uxFyw/z3O6P0+3LBCEYCqpWuquo12ra1duvPw3p9tG3ieTju2jbPMryNYMwPI5DH5MZCfJQaaG5tvjY2Znbd0+mEUXvNMZagIooikNuuE9o5kJE0Viu3MTD2ZAxDB4gxVpvOQiRpXsR+eHNdTqmQ0vd97A1LCYLAAlOv2kFnkHGrUYUP/MZxDBMlY7WUbYOV/8MPmBEVO2QPmJ4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 11 17 21 43 36 window\"\n        title=\"2020 11 17 21 43 36 window\"\n        src=\"/static/ca2b613d0bcd268b24bc6cf8b583d2e1/ad00e/2020-11-17-21_43_36-window.png\"\n        srcset=\"/static/ca2b613d0bcd268b24bc6cf8b583d2e1/1f09d/2020-11-17-21_43_36-window.png 471w,\n/static/ca2b613d0bcd268b24bc6cf8b583d2e1/f1901/2020-11-17-21_43_36-window.png 942w,\n/static/ca2b613d0bcd268b24bc6cf8b583d2e1/ad00e/2020-11-17-21_43_36-window.png 1366w\"\n        sizes=\"(max-width: 1366px) 100vw, 1366px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"getting-data-from-gui\" style=\"position:relative;\"><a href=\"#getting-data-from-gui\" aria-label=\"getting data from gui permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Getting data from GUI</h2>\n<p>If you want to get the data once, you can go to <a href=\"https://compliance.microsoft.com/auditlogsearch\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">audit log</a> and search for <strong>Allowed computer to sync files</strong> event:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1349px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9e4ea789341094a3932750047bc5ed60/c367c/2020-11-17-21_57_07-window.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.64755838641189%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABZElEQVQoz5WSyU7DQAyG88rcAYkn4VDBjReo6IkDvSCBhAQSKKFZmsnaZrJM9h+Pu6i0vTCK5cQz89m/HcO2bXiexyaEDxGleP5wMP/0MCdvugJhFCNJEsRxjDiK/ngd15amKeq6huHYDhyCugRM4whWonD3JnH/muHhXaJsR/xnGRpmWiZXGFLWsiygCklbAz0d+q7jzH3fo6P3qixRVRWapuHvYRj2No4jAR0HruvC932EYciHdbUiCCGzDFWRU5ISbdsyZL1eI6O4jtW1Yohe2jNwsVhguVwiCAIGKqUQUc+klGQZJ9DV7S4erxOg53pcnRBiAyTAKiHpRUFNj5DnOVW2kXx4cWfHMePHsrYTFjS5ALFUmLyk+PISlHmGft+f4QSm492+hz17g38bkiy0ZLKqbuCuFFTT8aFjyCHs7JT1QLTtJOtGN6rQOs5KZNh2b/pt4mL2hMvbCW6urjF9nOEXXQWwntjr2BwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 11 17 21 57 07 window\"\n        title=\"2020 11 17 21 57 07 window\"\n        src=\"/static/9e4ea789341094a3932750047bc5ed60/c367c/2020-11-17-21_57_07-window.png\"\n        srcset=\"/static/9e4ea789341094a3932750047bc5ed60/1f09d/2020-11-17-21_57_07-window.png 471w,\n/static/9e4ea789341094a3932750047bc5ed60/f1901/2020-11-17-21_57_07-window.png 942w,\n/static/9e4ea789341094a3932750047bc5ed60/c367c/2020-11-17-21_57_07-window.png 1349w\"\n        sizes=\"(max-width: 1349px) 100vw, 1349px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>From this level you you find machine's domain data by choosing <strong>More information</strong>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1348px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5cef8e03030be33945e84f0ae0b3c620/3d405/2020-11-17-21_59_33-window.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.64755838641189%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7CAAAOwgEVKEqAAAABWklEQVQoz3WRzWrCQBSFfdr2CUoR2o2LutDOTzKZGIUuioGuuxBc9RWKdJJR6EJ0U8RiJoaAJrEnmUKxtIdwuQz3O2fmpsUYcxyn2+0SQjwpfR+fTynVWud5fiyK0z+qqqrFKHUcTimRngQjhAiCgHMex/HhcMBQasxyuVyv12ma/uIB18kWQzgqkgFHUZTt95iAy3g8DsNwNpvZwB9YcHZ1517cEkaJ58nBYIBk2AG2yai7JDHGJEmSZdkZjExP+q7FajAYDoeu6yqlkt2uLCsw6k3NtcbJarU6NrIWDSxqjUYjYLBA4wqxwLW3W7PZFGmKyapRWZYgi6JAY99MuSvuCaH15pxer8cZQ9WROp3KY5YUxpwtuXk24O9tCyn7/T4A5Hc6HfSc0Veln1T+HJlmSX//rfraUkrWyK4dFU4q1vPPSn/kdq5sDCaL98vpy/XD4027PZlOvwB+kKoWdXyYhAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 11 17 21 59 33 window\"\n        title=\"2020 11 17 21 59 33 window\"\n        src=\"/static/5cef8e03030be33945e84f0ae0b3c620/3d405/2020-11-17-21_59_33-window.png\"\n        srcset=\"/static/5cef8e03030be33945e84f0ae0b3c620/1f09d/2020-11-17-21_59_33-window.png 471w,\n/static/5cef8e03030be33945e84f0ae0b3c620/f1901/2020-11-17-21_59_33-window.png 942w,\n/static/5cef8e03030be33945e84f0ae0b3c620/3d405/2020-11-17-21_59_33-window.png 1348w\"\n        sizes=\"(max-width: 1348px) 100vw, 1348px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>And finding <strong>MachineDomainInfo</strong> there:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1347px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6be352e3c4e8bff5b1e68a4ac91933e9/6aacb/2020-11-17-22_03_27-window.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.43524416135881%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7CAAAOwgEVKEqAAAABmUlEQVQoz2WRzUsCURTF+2ujP6CVUDSbBEdn3nw9vzYtihI0W1mgQWQqipiLBMfnQk0nS0PHGTVMp86ouenyuFyG9zvnvjN7hBBZlr1eryAIGqXBIE4QM2ON6XQ6m81N0ywUCqVSKZ/P12q1n3U5joO+R0RRliVRFKhGRVFUVTUcDhMiMcY+P4eWbY/Go/R9Jvv0lMvlX/7gTQF2nTcYDNHhjHVYo/Fl29/z+dyyWk323uv1u93xcOja7mBVIoenyv6RQERB02goFIKzJMtM14et1rjbRc/c3GRvbx9TKVapYOPlarVdG54aDSprbENGIhEXZswwjLFp2rZdKpefq1WcnmHsHvwHq25Fo1Fg4DEoigLYsizHWUHi6vIyeX2dSCTi8XgymYzFYsVicRuYpKgBQXAHSfL5fJDjeb5er08mE9xoNpv4F/iIRPyBgI/nTzgOEltYpdTv9wOAIcdxG17X9cFgsFgsEFmn04H/6//AcI9SStYFZ8ijQwjwFGkvl4Db7fZbvz8afFwUywfpB8/Z+bHHk7q7+wW1+pKSaLpSZgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 11 17 22 03 27 window\"\n        title=\"2020 11 17 22 03 27 window\"\n        src=\"/static/6be352e3c4e8bff5b1e68a4ac91933e9/6aacb/2020-11-17-22_03_27-window.png\"\n        srcset=\"/static/6be352e3c4e8bff5b1e68a4ac91933e9/1f09d/2020-11-17-22_03_27-window.png 471w,\n/static/6be352e3c4e8bff5b1e68a4ac91933e9/f1901/2020-11-17-22_03_27-window.png 942w,\n/static/6be352e3c4e8bff5b1e68a4ac91933e9/6aacb/2020-11-17-22_03_27-window.png 1347w\"\n        sizes=\"(max-width: 1347px) 100vw, 1347px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>You can also export the results to <code class=\"language-text\">.csv</code> file. Unfortunately, it only exports basic details, without any option to include what we saw under <strong>More information</strong>.</p>\n<h2 id=\"getting-data-programatically\" style=\"position:relative;\"><a href=\"#getting-data-programatically\" aria-label=\"getting data programatically permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Getting data programatically</h2>\n<p>Using <a href=\"https://docs.microsoft.com/en-us/powershell/exchange/exchange-online-powershell?view=exchange-ps\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Exchange Online PowerShell module</a> you can get data on scheduled basis. You can also format your data in whatever way you prefer, so it seems pretty neat to explore that option.</p>\n<p>Before we start, let's define some basic variables:</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token comment\"># Paths</span>\n<span class=\"token variable\">$userDataFilePath</span> = <span class=\"token function\">Join-Path</span> <span class=\"token variable\">$logFolder</span> <span class=\"token string\">'SyncEvents.xlsx'</span>\n\n<span class=\"token comment\"># Cloud service account</span>\n<span class=\"token variable\">$cloudServiceAccount</span> = <span class=\"token string\">'ServiceAccount@tenant.onmicrosoft.com'</span>\n<span class=\"token variable\">$cloudSvcAccCredsPath</span> = <span class=\"token function\">Join-Path</span> <span class=\"token string\">'C:\\Scripts\\Src\\'</span> <span class=\"token string\">\"<span class=\"token variable\">$cloudServiceAccount</span>-creds.xml\"</span>\n<span class=\"token variable\">$cloudSvcAccCreds</span> = <span class=\"token function\">Import-Clixml</span> <span class=\"token variable\">$cloudSvcAccCredsPath</span>\n\n<span class=\"token comment\"># Set logging level</span>\n<span class=\"token variable\">$VerbosePreference</span> = <span class=\"token string\">'Continue'</span>\n\n<span class=\"token comment\"># Set how long to check in the past</span>\n<span class=\"token variable\">$checkUntil</span> = <span class=\"token punctuation\">(</span><span class=\"token function\">Get-Date</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>AddDays<span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>1<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Initialize</span>\n<span class=\"token variable\">$allToBeBlocked</span> = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token variable\">$end</span> = <span class=\"token punctuation\">(</span><span class=\"token function\">Get-Date</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Domains to be excluded from the report</span>\n<span class=\"token variable\">$domainGUIDArray</span> = @<span class=\"token punctuation\">(</span>\n  <span class=\"token string\">'11111111-aaaa-2222-3333-444444444444'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'bbbbbbbb-bc25-4436-dddd-eeeeeeeeeeee'</span>\n  <span class=\"token punctuation\">)</span></code></pre></div>\n<p>Then let's connect to Exchange Online and get some data:</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token function\">Connect-ExchangeOnline</span> <span class=\"token operator\">-</span>Credential <span class=\"token variable\">$cloudSvcAccCreds</span>\n\n<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$end</span> <span class=\"token operator\">-gt</span> <span class=\"token variable\">$checkUntil</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\"># Generate session ID</span>\n    <span class=\"token variable\">$sessID</span> = <span class=\"token string\">\"OneDriveSyncCheck-<span class=\"token function\">$<span class=\"token punctuation\">(</span><span class=\"token function\">Get-Random</span><span class=\"token punctuation\">)</span></span>\"</span>\n    <span class=\"token variable\">$start</span> = <span class=\"token variable\">$end</span><span class=\"token punctuation\">.</span>AddHours<span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>1<span class=\"token punctuation\">)</span>\n    <span class=\"token function\">Write-Verbose</span> <span class=\"token string\">\"Checking entries to <span class=\"token variable\">$end</span>\"</span>  \n    <span class=\"token variable\">$res</span> = <span class=\"token variable\">$null</span>\n    <span class=\"token variable\">$params</span> = @<span class=\"token punctuation\">{</span>\n      Operations = <span class=\"token string\">'ManagedSyncClientAllowed'</span>\n      StartDate = <span class=\"token variable\">$start</span>\n      EndDate = <span class=\"token variable\">$end</span>\n      ResultSize = 5000\n      SessionCommand = <span class=\"token string\">'ReturnNextPreviewPage'</span>\n      SessionID = <span class=\"token variable\">$sessID</span>\n      ErrorAction = <span class=\"token string\">'Stop'</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token variable\">$res</span> = <span class=\"token function\">Search-UnifiedAuditLog</span> @params\n    <span class=\"token function\">Write-Verbose</span> <span class=\"token string\">\"Found <span class=\"token function\">$<span class=\"token punctuation\">(</span><span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>count<span class=\"token punctuation\">)</span></span> entries\"</span>\n    <span class=\"token variable\">$wouldBeBlocked</span> = <span class=\"token variable\">$res</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Where-Object</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token punctuation\">(</span><span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>AuditData <span class=\"token punctuation\">|</span> <span class=\"token function\">ConvertFrom-Json</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>MachineDomainInfo <span class=\"token operator\">-notin</span> <span class=\"token variable\">$domainGUIDArray</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token variable\">$allToBeBlocked</span> <span class=\"token operator\">+=</span> <span class=\"token variable\">$wouldBeBlocked</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Sort-Object</span> userids <span class=\"token operator\">-</span>unique <span class=\"token punctuation\">|</span> <span class=\"token function\">Select-Object</span> <span class=\"token operator\">-</span>Property UserIds<span class=\"token punctuation\">,</span> @<span class=\"token punctuation\">{</span>n=<span class=\"token string\">\"UserAgent\"</span><span class=\"token punctuation\">;</span>e=<span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>AuditData <span class=\"token punctuation\">|</span> <span class=\"token function\">ConvertFrom-Json</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>UserAgent<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> CreationDate\n    <span class=\"token variable\">$mostRecentEntry</span> = <span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>CreationDate <span class=\"token punctuation\">|</span> <span class=\"token function\">Sort-Object</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Select-Object</span> <span class=\"token operator\">-</span>First 1\n    <span class=\"token function\">Write-Verbose</span> <span class=\"token string\">\"End date set to <span class=\"token variable\">$mostRecentEntry</span>\"</span>\n    <span class=\"token variable\">$end</span> = <span class=\"token variable\">$mostRecentEntry</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\"># In case any errors, always worth reconnecting</span>\n    <span class=\"token function\">Connect-ExchangeOnline</span> <span class=\"token operator\">-</span>Credential <span class=\"token variable\">$cloudSvcAccCreds</span>\n    <span class=\"token function\">Write-Error</span> <span class=\"token variable\">$_</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span> <span class=\"token comment\"># end of loop</span></code></pre></div>\n<h2 id=\"code-deep-dive\" style=\"position:relative;\"><a href=\"#code-deep-dive\" aria-label=\"code deep dive permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Code deep dive</h2>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token comment\"># Paths</span>\n<span class=\"token variable\">$userDataFilePath</span> = <span class=\"token function\">Join-Path</span> <span class=\"token variable\">$logFolder</span> <span class=\"token string\">'SyncEvents.xlsx'</span>\n\n<span class=\"token comment\"># Cloud service account</span>\n<span class=\"token variable\">$cloudServiceAccount</span> = <span class=\"token string\">'ServiceAccount@tenant.onmicrosoft.com'</span>\n<span class=\"token variable\">$cloudSvcAccCredsPath</span> = <span class=\"token function\">Join-Path</span> <span class=\"token string\">'C:\\Scripts\\Src\\'</span> <span class=\"token string\">\"<span class=\"token variable\">$cloudServiceAccount</span>-creds.xml\"</span>\n<span class=\"token variable\">$cloudSvcAccCreds</span> = <span class=\"token function\">Import-Clixml</span> <span class=\"token variable\">$cloudSvcAccCredsPath</span>\n\n<span class=\"token comment\"># Set logging level</span>\n<span class=\"token variable\">$VerbosePreference</span> = <span class=\"token string\">'Continue'</span></code></pre></div>\n<p>We only define basic variables here, nothing special. Next, let's define time range to be checked for events. Make sure to check <strong>how long it takes to get all the data</strong>, it might depend on your tenant size:</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token comment\"># Set how long to check in the past</span>\n<span class=\"token variable\">$checkUntil</span> = <span class=\"token punctuation\">(</span><span class=\"token function\">Get-Date</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>AddDays<span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>1<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Initialize</span>\n<span class=\"token variable\">$allToBeBlocked</span> = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token variable\">$end</span> = <span class=\"token punctuation\">(</span><span class=\"token function\">Get-Date</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Next, we can define an array of domains we'd like to exclude from the report. If you don't exclude anything, your list might be pretty big soon:</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token comment\"># Domains to be excluded from the report</span>\n<span class=\"token variable\">$domainGUIDArray</span> = @<span class=\"token punctuation\">(</span>\n  <span class=\"token string\">'11111111-aaaa-2222-3333-444444444444'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'bbbbbbbb-bc25-4436-dddd-eeeeeeeeeeee'</span>\n  <span class=\"token punctuation\">)</span></code></pre></div>\n<p>Then we need to connect to Exchange Online. Make sure that the sign-in method you use is suitable for unattended run. You can have a look at <a href=\"https://docs.microsoft.com/en-us/powershell/exchange/app-only-auth-powershell-v2?view=exchange-ps\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">App-only authentication</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token function\">Connect-ExchangeOnline</span> <span class=\"token operator\">-</span>Credential <span class=\"token variable\">$cloudSvcAccCreds</span></code></pre></div>\n<p>And now we start our processing. We want our loop to end once it reaches certain timestamp and we wrap all the processing in try catch block for error handling:</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$end</span> <span class=\"token operator\">-gt</span> <span class=\"token variable\">$checkUntil</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span></code></pre></div>\n<p>Then we generate session ID to be used while sending all the requests. <a href=\"https://docs.microsoft.com/en-us/powershell/module/exchange/search-unifiedauditlog?view=exchange-ps#parameters\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">See Parameters of <code class=\"language-text\">Search-UnifiedAuditLog</code></a> for details.</p>\n<p>For <code class=\"language-text\">SessionCommand</code> we set <code class=\"language-text\">ReturnNextPreviewPage</code> value, to get sorted data.</p>\n<p><code class=\"language-text\">ResultSize</code> is set to 5000, which is maximum value.</p>\n<p>We also need to specify <code class=\"language-text\">ErrorAction = &#39;Stop&#39;</code> so that we can use <code class=\"language-text\">try/catch</code> block.</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">    <span class=\"token comment\"># Generate session ID</span>\n    <span class=\"token variable\">$sessID</span> = <span class=\"token string\">\"OneDriveSyncCheck-<span class=\"token function\">$<span class=\"token punctuation\">(</span><span class=\"token function\">Get-Random</span><span class=\"token punctuation\">)</span></span>\"</span>\n    <span class=\"token variable\">$start</span> = <span class=\"token variable\">$end</span><span class=\"token punctuation\">.</span>AddHours<span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>1<span class=\"token punctuation\">)</span>\n    <span class=\"token function\">Write-Verbose</span> <span class=\"token string\">\"Checking entries to <span class=\"token variable\">$end</span>\"</span>  \n    <span class=\"token variable\">$res</span> = <span class=\"token variable\">$null</span>\n    <span class=\"token variable\">$params</span> = @<span class=\"token punctuation\">{</span>\n      Operations = <span class=\"token string\">'ManagedSyncClientAllowed'</span>\n      StartDate = <span class=\"token variable\">$start</span>\n      EndDate = <span class=\"token variable\">$end</span>\n      ResultSize = 5000\n      SessionCommand = <span class=\"token string\">'ReturnNextPreviewPage'</span>\n      SessionID = <span class=\"token variable\">$sessID</span>\n      ErrorAction = <span class=\"token string\">'Stop'</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>Then we use <a href=\"https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_splatting?view=powershell-7.1\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">splatting</a> to run our command.</p>\n<p>If it runs successfully, we process the data to get desired format.</p>\n<p>Once we get data processed, we check for most recent entry and then set it as new end date for next search.</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">    <span class=\"token variable\">$res</span> = <span class=\"token function\">Search-UnifiedAuditLog</span> @params\n    <span class=\"token function\">Write-Verbose</span> <span class=\"token string\">\"Found <span class=\"token function\">$<span class=\"token punctuation\">(</span><span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>count<span class=\"token punctuation\">)</span></span> entries\"</span>\n    <span class=\"token variable\">$wouldBeBlocked</span> = <span class=\"token variable\">$res</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Where-Object</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token punctuation\">(</span><span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>AuditData <span class=\"token punctuation\">|</span> <span class=\"token function\">ConvertFrom-Json</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>MachineDomainInfo <span class=\"token operator\">-notin</span> <span class=\"token variable\">$domainGUIDArray</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token variable\">$allToBeBlocked</span> <span class=\"token operator\">+=</span> <span class=\"token variable\">$wouldBeBlocked</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Sort-Object</span> userids <span class=\"token operator\">-</span>unique <span class=\"token punctuation\">|</span> <span class=\"token function\">Select-Object</span> <span class=\"token operator\">-</span>Property UserIds<span class=\"token punctuation\">,</span> @<span class=\"token punctuation\">{</span>n=<span class=\"token string\">\"UserAgent\"</span><span class=\"token punctuation\">;</span>e=<span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>AuditData <span class=\"token punctuation\">|</span> <span class=\"token function\">ConvertFrom-Json</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>UserAgent<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> CreationDate\n    <span class=\"token variable\">$mostRecentEntry</span> = <span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>CreationDate <span class=\"token punctuation\">|</span> <span class=\"token function\">Sort-Object</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Select-Object</span> <span class=\"token operator\">-</span>First 1\n    <span class=\"token function\">Write-Verbose</span> <span class=\"token string\">\"End date set to <span class=\"token variable\">$mostRecentEntry</span>\"</span>\n    <span class=\"token variable\">$end</span> = <span class=\"token variable\">$mostRecentEntry</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">{</span></code></pre></div>\n<p>As most of the errors I saw were caused by disconnected session, let's try to reconnect. Worth noting - in case any error, new value for <code class=\"language-text\">$end</code> won't be set so the previous query will be executed:</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">    <span class=\"token comment\"># In case any errors, always worth reconnecting</span>\n    <span class=\"token function\">Connect-ExchangeOnline</span> <span class=\"token operator\">-</span>Credential <span class=\"token variable\">$cloudSvcAccCreds</span>\n    <span class=\"token function\">Write-Error</span> <span class=\"token variable\">$_</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span> <span class=\"token comment\"># end of loop</span></code></pre></div>","frontmatter":{"date":"2020-11-30 20:33","title":"Finding all domains used to sync OneDrive","description":"If you're going to restrict syncing OneDrive for Business libraries to specific domains only, you might want to first check, which domains are currently being used to synchronize data.","tags":["onedrive","office 365","exchange online","audit log"]}}},"pageContext":{"id":"93698b5c-0e46-5cff-aece-40c349eeafdf"}},"staticQueryHashes":["2483265550"]}